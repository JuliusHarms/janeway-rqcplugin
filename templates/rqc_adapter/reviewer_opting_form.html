<!--
© Julius Harms, Freie Universität Berlin 2025

This template renders the form where reviewers can opt in or out from RQC.
-->

<div class="title-area" id="rqc_opting_form_title">
   <h2>Take part in Review Quality Collector?</h2>
</div>
<div class="content">
    <div class="callout info-box">
        <p>
            <a href="https://reviewqualitycollector.org" target="_blank" rel="noopener">Review Quality Collector</a> is an initiative for improving the quality of scientific peer review.
            Its core is a mechanism that supplies a reviewer with a receipt for their work for each journal year.
            The receipt certifies the quality of the reviewing work based on a journal-specific review quality definition.
            This turns reviewing into a source of reputation and so improves reviewer motivation and hence review quality.
        </p>
        <p>
            See <a href="https://reviewqualitycollector.org/t/faq" target="_blank" rel="noopener" >reviewqualitycollector.org/t/faq</a> for details.
        </p>
    </div>
    <div class="callout primary">
            <h3> Participation Agreement</h3>

            <p>
                <strong>I want to participate in Review Quality Collector (RQC) for all my reviews for this journal this year.</strong>
            </p>

            <ul class="consent-points">
                <li>My reviewing data will be submitted to RQC and RQC will provide me with a reviewing receipt in exchange.</li>
                <li>I understand the purpose of RQC and its use of my data as described in the
                    <a href="https://reviewqualitycollector.org/t/terms-and-privacy"
                       target="_blank"
                       rel="noopener"
                       class="privacy-link">Terms and Privacy Policy</a>.
                </li>
                <li>I can make a separate decision on this for other journals.</li>
                <li>I can make a separate decision on this for the present journal next year.</li>
            </ul>
    </div>
    <div id="help_label" class="callout warning" style="display: none; margin: 10px 0; animation: fadeIn 0.3s;">
        <p><strong>You need to select an option below before you can submit the review form.</strong></p>
    </div>
    <form method="POST" id="rqc_opting_form" action= "{% url 'rqc_adapter_set_reviewer_opting_status' %}">
        {% csrf_token %}
        <input type="hidden" name="assignment_id" value="{{ assignment.id }}">
        {% if access_code %}
            <input type="hidden" name="access_code" value="{{ access_code }}">
        {% endif %}
        {{ form.status_selection_field }}
        {{ form.status_selection_field.errors }}
         <button type="submit" class="button success">Submit Decision</button>
    </form>
</div>
<script>
    // When a user tries to submit a review form without first registering an RQC opting decision
    // the submission is blocked and the window is scrolled back to the RQC opting decision form.
    // Help text is displayed to inform the user.
    document.addEventListener('DOMContentLoaded', function() {
        const rqc_opting_form = document.querySelector("#rqc_opting_form");
        const rqc_opting_form_title = document.querySelector("#rqc_opting_form_title");
        const help_label = document.querySelector("#help_label");
        const rqc_opting_form_pos = rqc_opting_form_title.offsetTop;
        const forms = document.querySelectorAll('form[method="POST"][enctype="multipart/form-data"]');
        let has_submitted = false;

        rqc_opting_form.onsubmit = function(e) {
            has_submitted = true;
            help_label.style.display = 'none';
        }

        for (let i = 0; i < forms.length; i++) {
            const form = forms[i];
            if (form === rqc_opting_form) {
                continue;
            }

            form.onsubmit = function(e) {
                if (!has_submitted) {
                    e.preventDefault();

                    rqc_opting_form.classList.add('rqc-highlighted');

                    help_label.style.display = 'block';
                    help_label.style.animation = 'fadeIn 0.3s';

                    window.scrollTo({
                        top: rqc_opting_form_pos - 20,
                        behavior: 'smooth'
                    });

                    setTimeout(() => {
                        if (help_label.style.display === 'block') {
                            help_label.style.animation = 'fadeOut 0.3s';
                            setTimeout(() => {
                                help_label.style.display = 'none';
                            }, 300);
                        }
                    }, 8000);

                    setTimeout(() => {
                        rqc_opting_form.classList.remove('rqc-highlighted');
                    }, 3000);
                }
            }
        }
    });
</script>