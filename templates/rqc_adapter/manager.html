{% extends "admin/core/base.html" %}
{% load foundation %}

{% block title %}RQC Adapter Manager{% endblock %}

{% block body %}
<div class="box">
    <div class="title-area">
        <h2>Review Quality Collector (RQC)</h2>
    </div>
    <p>Review Quality Collector (RQC) is an initiative for improving the quality of scientific peer review. Its core is a mechanism that supplies a reviewer with a receipt for their work for each journal year. The receipt certifies the quality of the reviewing work based on a journal-specific review quality definition. This turns reviewing into a source of reputation and so improves reviewer motivation and hence review quality.<br> See <a href="https://reviewqualitycollector.org/">reviewqualitycollector.org</a> for details.</p>
    <p>RQC Configuration for the current journal</p>
    <div class="content">
        <p>The journal ID as generated by RQC (you may need to ask your publisher to create one at reviewqualitycollector.org or use RQC\'s Demo mode to try it out all by yourself):</p>
        <form method="POST" action="{% url 'set_journal_id' %}">
            {% csrf_token %}
            {{ form|foundation }}
            <input type="text" name="journal_id" required>
            <button type="submit" class="button">Set the journal id and the journal api key</button>
        </form>
        <!-- TEST: Form -->
        <form method="POST" action="{% url 'test_request' %}">
            {% csrf_token %}
            <button type="submit" class="button">MHS-API-CHECK TEST</button>
        </form>
        <form id="test-post-form" method="POST" action="{% url 'test_post' %}">
            {% csrf_token %}
            <button type="submit" class="button">MHS-API-SUBMISSION TEST</button>
        </form>
    </div>
</div>
<script>
    document.getElementById("test-post-form").addEventListener("submit", function (event) {
        event.preventDefault();
        const button = this.querySelector('button');
        button.disabled = true;
        fetch(this.action, {
            method: "POST",
            body: new FormData(this),
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Accept": "application/json"
            }
        }).then(response => response.json()).then(data => {
            if (data.redirect_target) {
                window.open(data.redirect_target, '_blank');
            } else {
                alert(data.error || "No redirect target received.");
            }
        }).catch(error => {
            console.error("Error:", error);
            alert("An error occurred while processing your request.");
        }).finally(() => {
            button.disabled = false;
        });
    });
</script>
{% endblock body %}